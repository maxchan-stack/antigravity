<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #9B8A5E;
            /* Earth Gold */
            --primary-hover: #86754d;
            --accent-color: #B4745A;
            /* Rose Gold */
            --accent-hover: #9c634d;
            --text-color: #45464D;
            /* Obsidian Grey */
            --bg-color: #f7f7f7;
            --white: #ffffff;
            --danger: #cf3b3b;
            --danger-hover: #b03232;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 16px;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            color: #888;
            margin-top: 12px;
            margin-bottom: 4px;
            padding-left: 4px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            text-align: left;
        }

        /* Primary Button Style */
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(155, 138, 94, 0.2);
        }

        /* Secondary Button Style */
        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--text-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #e0e0e0;
        }

        /* Accent Button Style */
        .btn-accent {
            background-color: white;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }

        .btn-accent:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: white;
        }

        /* Danger Button Style */
        .btn-danger {
            background-color: #fff0f0;
            color: var(--danger);
            border: 1px solid #ffcccc;
        }

        .btn-danger:hover:not(:disabled) {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .icon {
            font-size: 16px;
        }

        /* Status Toast */
        #status-area {
            position: fixed;
            bottom: 16px;
            left: 16px;
            right: 16px;
            background: #333;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 13px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }

        #status-area.show {
            opacity: 1;
        }

        #status-area.error {
            background: var(--danger);
        }

        #status-area.success {
            background: #4caf50;
        }

        .loading-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            display: none;
        }

        button.loading .loading-spinner {
            display: inline-block;
        }

        button.loading .btn-text {
            opacity: 0.8;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">

        <div class="section-title">æ ¸å¿ƒåŠŸèƒ½</div>
        <div class="card">
            <button class="btn-primary" onclick="run('generatePasswordsForAllSheets', this, 'æ­£åœ¨ç”¢ç”ŸæŸ¥è©¢ç¢¼...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ”¢</span>
                <span class="btn-text">ç”¢ç”Ÿæ‰€æœ‰æŸ¥è©¢ç¢¼ (5ç¢¼)</span>
            </button>
            <button class="btn-accent" onclick="run('sendQueryCodesToStudents', this, 'æ­£åœ¨å¯„é€ Email...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ“§</span>
                <span class="btn-text">å¯„é€æŸ¥è©¢ç¢¼ (Email)</span>
            </button>
        </div>

        <div class="section-title">è­‰æ˜æ–‡ä»¶</div>
        <div class="card">
            <button class="btn-secondary" onclick="run('showCertificateDialog', this, 'é–‹å•Ÿè¦–çª—ä¸­...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ“„</span>
                <span class="btn-text">ç”¢ç”Ÿæˆç¸¾è­‰æ˜</span>
            </button>
            <button class="btn-secondary" onclick="run('showInstructionCard', this, 'æ­£åœ¨ç”¢ç”Ÿåœ–å¡...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ“±</span>
                <span class="btn-text">å°ˆæ¡ˆåˆ†äº«åœ–å¡</span>
            </button>
        </div>

        <div class="section-title">å®‰å…¨ç®¡ç†</div>
        <div class="card">
            <button class="btn-secondary" onclick="run('viewSecurityLog', this, 'è¼‰å…¥æ—¥èªŒä¸­...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ“Š</span>
                <span class="btn-text">æŸ¥çœ‹å®‰å…¨æ—¥èªŒ</span>
            </button>
            <button class="btn-secondary" onclick="run('checkSheetPermissions', this, 'æª¢æŸ¥æ¬Šé™ä¸­...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ”’</span>
                <span class="btn-text">æª¢æŸ¥è©¦ç®—è¡¨æ¬Šé™</span>
            </button>
            <button class="btn-secondary" onclick="run('unlockSpecificStudent', this, 'åŸ·è¡Œä¸­...')">
                <span class="loading-spinner"></span>
                <span class="icon">ğŸ”“</span>
                <span class="btn-text">è§£é™¤ç‰¹å®šå­¸è™Ÿé–å®š</span>
            </button>
            <button class="btn-danger" onclick="run('emergencyUnlockAll', this, 'ç·Šæ€¥è§£é–ä¸­...')">
                <span class="loading-spinner"></span>
                <span class="icon">âš ï¸</span>
                <span class="btn-text">ç·Šæ€¥è§£é™¤å…¨éƒ¨é–å®š</span>
            </button>
        </div>

    </div>

    <div id="status-area">Ready</div>

    <script>
        function run(serverFunction, btn, loadingMsg) {
            // UI Loading State
            const originalText = btn.querySelector('.btn-text').innerText;
            const originalPointerEvents = btn.style.pointerEvents;

            btn.classList.add('loading');
            btn.disabled = true;
            btn.querySelector('.btn-text').innerText = loadingMsg || 'è™•ç†ä¸­...';

            showToast(loadingMsg || 'è™•ç†ä¸­...', 'normal');

            google.script.run
                .withSuccessHandler(function (response) {
                    // Reset Button
                    btn.classList.remove('loading');
                    btn.disabled = false;
                    btn.querySelector('.btn-text').innerText = originalText;

                    showToast('âœ… åŸ·è¡ŒæˆåŠŸï¼', 'success');

                    // Specific handling for dialog popups if needed, 
                    // though most just run backend logic or open dialogs directly
                })
                .withFailureHandler(function (error) {
                    // Reset Button
                    btn.classList.remove('loading');
                    btn.disabled = false;
                    btn.querySelector('.btn-text').innerText = originalText;

                    showToast('âŒ éŒ¯èª¤ï¼š' + error.message, 'error');
                })
            [serverFunction](); // Call the function dynamically
        }

        let toastTimeout;
        function showToast(msg, type) {
            const toast = document.getElementById('status-area');
            toast.innerText = msg;
            toast.className = ''; // reset classes
            toast.classList.add('show', type);

            if (toastTimeout) clearTimeout(toastTimeout);

            // Auto hide after 3 seconds if success or normal, longer for error
            const duration = type === 'error' ? 5000 : 3000;
            toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
    </script>
</body>

</html>